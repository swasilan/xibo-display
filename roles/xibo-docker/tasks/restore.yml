---
# --------------------------------------------------
# Restore-Script Generator fÃ¼r Xibo
# --------------------------------------------------
# Generiert ein interaktives Restore-Skript statt direktem Restore wÃ¤hrend Installation

###########################################################################
# Variablen definieren
###########################################################################
- name: Set restore paths
  set_fact:
    restore_tmp_dir: "{{ restore_tmp_dir | default('/tmp/xibo_restore') }}"
    backup_dir: "{{ backup_dir | default('/opt/xibo-backup/backups') }}"
    cms_target_dir: "{{ cms_target_dir | default('/opt/xibo-docker/shared/cms') }}"
    rollback_dir: "{{ rollback_dir | default('/opt/xibo-backup/rollback') }}"
    xibo_db_container: "{{ xibo_db_container | default('xibo-db') }}"
    xibo_db_name: "{{ xibo_db_name | default('xibo') }}"
    xibo_db_user: "{{ xibo_db_user | default('xibo') }}"
    xibo_db_password: "{{ xibo_db_password | default('xibopass') }}"

###########################################################################
# Vorbereitungen
###########################################################################
- name: Ensure required directories exist
  file:
    path: "{{ item }}"
    state: directory
    mode: "0755"
  loop:
    - "{{ backup_dir }}"
    - "{{ cms_target_dir }}"
    - "{{ rollback_dir }}"

###########################################################################
# Generiere Restore-Skript
###########################################################################
- name: Generate interactive restore script from template
  template:
    src: restore-xibo-backup.sh.j2
    dest: "{{ backup_dir }}/restore-xibo-backup.sh"
    mode: "0755"
    owner: root
    group: root

- name: Info about restore script
  debug:
    msg: |
      âœ… Restore-Skript wurde erstellt: {{ backup_dir }}/restore-xibo-backup.sh
      
      ðŸ“‹ Verwendung:
         sudo {{ backup_dir }}/restore-xibo-backup.sh
      
      Das Skript zeigt alle verfÃ¼gbaren Backups und fÃ¼hrt dich durch den Restore-Prozess.
