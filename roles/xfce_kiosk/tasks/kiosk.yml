############################################
# XFCE Config-Verzeichnisse
############################################
- name: XFCE Config-Verzeichnisse anlegen
  ansible.builtin.file:
    path: "{{ kiosk_home }}/.config/xfce4/xfconf/xfce-perchannel-xml"
    state: directory
    owner: "{{ kiosk_user }}"
    group: "{{ kiosk_user }}"
    mode: '0755'
  become: yes

############################################
# XFCE Session absichern
############################################
- name: XFCE Session hart konfigurieren
  ansible.builtin.copy:
    dest: "{{ kiosk_home }}/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-session.xml"
    owner: "{{ kiosk_user }}"
    group: "{{ kiosk_user }}"
    mode: '0644'
    content: |
      <?xml version="1.0" encoding="UTF-8"?>
      <channel name="xfce4-session" version="1.0">
        <property name="general" type="empty">
          <property name="SaveOnExit" type="bool" value="false"/>
          <property name="LockCommand" type="string" value=""/>
          <property name="LockScreen" type="bool" value="false"/>
        </property>
      </channel>
  become: yes

############################################
# Power Management deaktivieren
############################################
- name: XFCE Power Manager konfigurieren
  ansible.builtin.copy:
    dest: "{{ kiosk_home }}/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-power-manager.xml"
    owner: "{{ kiosk_user }}"
    group: "{{ kiosk_user }}"
    mode: '0644'
    content: |
      <?xml version="1.0" encoding="UTF-8"?>
      <channel name="xfce4-power-manager" version="1.0">
        <property name="xfce4-power-manager" type="empty">
          <property name="blank-on-ac" type="int" value="0"/>
          <property name="dpms-enabled" type="bool" value="false"/>
          <property name="sleep-display-ac" type="int" value="0"/>
          <property name="sleep-display-battery" type="int" value="0"/>
          <property name="lid-action-on-ac" type="int" value="0"/>
          <property name="lid-action-on-battery" type="int" value="0"/>
        </property>
      </channel>
  become: yes

############################################
# LightDM Autologin
############################################
- name: LightDM Autologin f√ºr Kiosk-User
  ansible.builtin.copy:
    dest: /etc/lightdm/lightdm.conf.d/50-kiosk.conf
    owner: root
    group: root
    mode: '0644'
    content: |
      [Seat:*]
      autologin-user={{ kiosk_user }}
      autologin-user-timeout=0
      greeter-session=lightdm-gtk-greeter
      user-session=xfce
  become: yes

############################################
# LightDM aktivieren
############################################
- name: LightDM aktivieren
  ansible.builtin.systemd:
    name: lightdm
    enabled: yes
  become: yes

############################################
# HINWEIS ZUM REBOOT
############################################
- name: Hinweis Reboot notwendig
  ansible.builtin.debug:
    msg: |
      ‚úÖ Installation abgeschlossen.
      üîÅ Ein REBOOT ist notwendig, damit:
        - VirtualBox Module sauber aktiv sind
        - LightDM Autologin greift
      üëâ Bitte jetzt manuell rebooten:
         sudo reboot
